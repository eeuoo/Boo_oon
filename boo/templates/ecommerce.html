<!DOCTYPE html>
<html lang="en" class="">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>뜬 구름</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="{{ url_for('static', filename="css/bootstrap.min.css") }}" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="{{ url_for('static', filename="css/mdb.min.css") }}" rel="stylesheet">
  <!-- style -->
  <link href="{{ url_for('static', filename="style/style.css") }}" rel="stylesheet">

</head>

<body>

{% block main %}
{% endblock main %}


  <!--  SCRIPTS  -->
  <!-- Handlebars -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/handlebars-v4.0.12.js')}}"></script>
  <!-- JQuery -->
  <script type="text/javascript" src="{{ url_for('static', filename= "js/jquery-3.3.1.min.js") }}"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="{{ url_for('static', filename="js/popper.min.js") }}"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="{{ url_for('static', filename="js/bootstrap.min.js") }}"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="{{ url_for('static', filename="js/mdb.min.js") }}"></script>
  <script>
    new WOW().init();

    // 화살표 함수 : panel8에서 모두 입력 시 panel9로 넘어감.
    function controlRegist(myId, panelId) {
      if(trimHas('modalLRInput12') && trimHas('modalLRInput13') && 
         trimHas('modalLRInput14') && trimHas('modalLRInput15')) {

        $('#' + myId).toggle();
        $('#' + panelId).toggle();
      } else {
        alert('정보를 정확히 기입해 주세요.');
      }
    }

    function trimHas(id){
      return $.trim($('#'+id).val()) != '' && $('#'+id).hasClass('valid')
    }       


    // 생년월일 함수
    $(function () {
      for (i = new Date().getFullYear(); i > 1929; i--) {
        $('#years').append($('<option />').val(i).html(i));
      }

      for (i = 1; i < 13; i++) {
        $('#months').append($('<option />').val(i).html(i));
      }
    
      updateNumberOfDays();

      $('#years, #months').change(function () {
        updateNumberOfDays();
      });

    });

    function updateNumberOfDays() {
      $('#days').html('');
      $('#days').append($('<option />').val('일').html('일'));
      month = $('#months').val();
      year = $('#years').val();
      days = daysInMonth(month, year);
      
      for (i = 1; i < days + 1 ; i++) {
        $('#days').append($('<option />').val(i).html(i));
      }
    }

    function daysInMonth(month, year) {
      return new Date(year, month, 0).getDate();
    }


    // 시도군 함수
    var cities = {
      '서울' : [ '강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', 
                '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', 
                '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
      '부산' : [ '강서구', '금정구', '남구', '동구', '동래구', '부산진구', '북구', 
                '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구', '기장군'],
      '인천' : [ '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '중구', '강화군', '옹진군'],
      '대구' : [ '남구', '달서구', '동구', '북구', '서구', '수성구', '중구', '달성군'],
      '광주' : [ '광산구', '남구', '동구', '북구', '서구'],
      '대전' : [ '대덕구', '동구', '서구', '유성구', '중구'],
      '울산' : [ '남구', '동구', '북구', '중구', '울주군'],
      '세종' : [ '조치원읍', '금남면', '부강면', '소정면', '연기면', '연동면', '연서면', 
                '장군면', '전동면', '전의면', '고운동', '대평동', '도담동', '보람동', 
                '소담동', '새롬동', '아름동', '종촌동', '한솔동'],
      '경기' : [ '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', 
                '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', 
                '여주시', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', 
                '하남시', '화성시', '가평군', '양평군', '연천군'],
      '강원' : [ '강릉시', '동해시', '삼척시', '속초시', '원주시', '춘천시', '태백시', '고성군', 
                '양구군', '양양군', '영월군', '인제군', '정선군', '철원군', '평창군', 
                '홍천군', '화천군', '횡성군'],
      '충북' : [ '제천시', '청주시', '충주시', '괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '증평군', '진천군'],
      '충남' : [ '계룡시', '공주시', '논산시', '당진시', '보령시', '서산시', '아산시', '천안시', 
                '금산군', '부여군', '서천군', '예산군', '청양군', '태안군', '홍성군'],
      '경북' : [ '경산시', '경주시', '구미시', '김천시', '문경시', '상주시', '안동시', '영주시', '영천시', 
                '포항시', '고령군', '군위군', '봉화군', '성주군', '영덕군', '영양군', '예천군', '울릉군', 
                '울진군', '의성군', '청도군', '청송군', '칠곡군'],
      '경남' : [ '거제시', '김해시', '밀양시', '사천시', '양산시', '진주시', '창원시', '통영시', '거창군', 
                '고성군', '남해군', '산청군', '의령군', '창녕군', '하동군', '함안군', '함양군', '합천군'],
      '전북' : [ '군산시', '김제시', '남원시', '익산시', '전주시', '정읍시', '고창군', 
                '무주군', '부안군', '순창군', '완주군', '임실군', '장수군', '진안군'],
      '전남' : [ '광양시', '나주시', '목포시', '순천시', '여수시', '강진군', '고흥군', 
                '곡성군', '구례군', '담양군', '무안군', '보성군', '신안군', '영광군', 
                '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
      '제주' : [ '서귀포시', '제주시']
    }

    $(function (){

      for (key in cities) {
        $('#sidogun').append($('<option />').val(key).html(key));
      }

      for (gu in cities['서울']){
      $('#city').append($('<option />').val(cities['서울'][gu]).html(cities['서울'][gu]))
      }

      $('#sidogun').change(function () {
          getCity();
        });
    });

    function getCity() {
      $('#city').html('');
      dos = $('#sidogun').val();
      cts = cities[dos];
      
      for(c in cts) {
        $('#city').append($('<option />').val(cts[c]).html(cts[c]));
      }
    }


    // 직업 함수
    var job = ['공무원', '교육', '사무직', '기술직', '농업, 어업', '건축, 건설', '법률', 
               '보건, 의료', '문화, 예술, 디자인', '음악', '스포츠', '신문, 방송, 매체', 
               '사회복지', '영업, 판매', '운전, 운송', '요식업','숙박, 여행','종교', '군인', '학생', '기타']

    for (j in job){  
      $('#job').append($('<option />').val(job[j]).html(job[j]));
    }


    // AJAX
    function send_ajax(url, method, data, dataType, fn) {
        $.ajax({
            url: url,
            data: data,
            type: method,
            dataType: dataType
        }).done(function (res) {
            if (fn)
              fn(res)
        }).fail(function (xhr, status, errorThrown) {
            console.error("Sorry, there was a problem!", xhr, status, errorThrown);
        }).always(function (xhr, status) {
            console.log("The request is complete!");
        });
    }

    // 비밀번호 확인 함수
    var ssn1 = document.getElementById("modalLRInput13");
    var ssn2 = document.getElementById("modalLRInput14");

    function ss() {
     
      if ($('#modalLRInput14').val().length != 0 && ssn1.value == ssn2.value ) {
        $('#modalLRInput14').removeClass("invalid").addClass("valid");
      } else {
        $('#modalLRInput14').removeClass("vaild").addClass("invalid");
      }

       if ($('#modalLRInput14').val().length == 0){
        $('#modalLRInput14').removeClass("vaild").removeClass("invalid");
      } 
    }


    // 필수 사항 입력 여부 체크 함수(panel9)
    $('#registForm').submit(function(event){
      if ( propSelected('years') || propSelected('months') ||  propSelected('days') || 
           propSelected('sidogun') || propSelected('job') ||
           $('#genderRadio input:radio:checked').length == 0 ) {

        alert('선택되지 않은 항목이 있습니다.');
        event.preventDefault();
        //$('#registSubmit').prop('onclick', false);
      }
    });

    function propSelected(id){
      return $('#'+id).prop('selectedIndex') == 0
    }


    // 엔터키 눌렀을 때 submit 되는 거 막기
    $('input').keydown(function() {
      if (event.keyCode === 13) {
        event.preventDefault();
      }
    });


    // 가입시 아이디, 이메일 중복 체크
    checkItOut('modalLRInput12') // 아이디 
    checkItOut('modalLRInput15') // 이메일

    function checkItOut(modalId) {
      var mid = '#' +  modalId 
      $(mid).focusout(function(){
            var id = $(this).val();
            // ajax 실행
            send_ajax('/boo/idcheck', 'POST', { username : id }, '', function(data) {
                if (data['username'] == '가입 가능') {
                  $(mid).removeClass('invalid').addClass('valid')
                }else {
                  $(mid).removeClass('valid').addClass('invalid')
                }
              }) // end ajax
        }); // end blur
    } // function checkItOut


    // 로그인시 아이디, 비밀번호 체크
    $('#modalLRInput10, #modalLRInput11').focusout(function() {
          var id = $('#modalLRInput10').val();
          var pw = $('#modalLRInput11').val();
          send_ajax('/boo/login', 'POST', { username : id, pw : pw },'', function(data) {

              if (id.length != 0 && data['login'] == '아이디 오류') {
                $('#modalLRInput10').removeClass('valid').addClass('invalid')
                $('#modalLRInput11').val('').removeClass('invalid, valid')

              } else if (id.length == 0 ) {
                $('#modalLRInput10').removeClass('invalid, valid')
                $('#modalLRInput11').val('').removeClass('invalid, valid')

              } else {
                $('#modalLRInput10').removeClass('invalid').addClass('valid')

                  if (pw.length != 0 && data['login'] == '비밀번호 오류') {
                    $('#modalLRInput11').removeClass('valid').addClass('invalid')
                  } else if (pw.length == 0 ) {
                    $('#modalLRInput11').removeClass('invalid, valid')
                  } else {
                    $('#modalLRInput11').removeClass('invalid').addClass('valid') 
                  }
                }
            }) // end ajax
      }); // end blur

      // 잘못된 회원 정보 입력 시 로그인 막기
      $('#loginForm').submit(function(event){

        if(!(trimHas('modalLRInput10') && trimHas('modalLRInput11'))) {
          alert('정보를 정확히 기입해 주세요.');
          event.preventDefault();
        } 

      });


      // 좋아요, 싫어요 처리 함수        
      function like_hate(my, el , id, mycolor, elsecolor) {
        if ($("#" + my + id).hasClass(mycolor)) {
            one(my, id, 'del', 'removeClass', mycolor);
            
          } else if ($("#"+ el + id).hasClass(elsecolor)){ 
            one(el, id, 'del', 'removeClass', elsecolor);
            one(my, id, 'add', 'addClass', mycolor);

          } else {
            one(my, id, 'add', 'addClass', mycolor)
          }
      }

      function one(feel, id, status, classAR, color){
        var one = parseInt($("#" + feel + "Cnt" + id).text())

        if (classAR == 'addClass'){
          $("#" + feel + id).addClass(color);
          if (feel == 'like'){
            $("#" + feel + "Cnt" + id).text(one + 1);
          }else { $("#" + feel + "Cnt" + id).text(one - 1); }
         
        } else {
          $("#" + feel + id).removeClass(color);
          if (feel == 'like'){
            $("#" + feel + "Cnt" + id).text(one - 1);
          }else { $("#" + feel + "Cnt" + id).text(one + 1); }
    
        }

        send_ajax('/boo/like_hate', 'POST', {'list_id' : id, 'num' : status, 'feel' : feel}, '');
      }

      // 카드 클릭시, 세부 내용 모달 띄우는 함수
      function card_modal(id){
        openModals(id);
        //getComment(id);
        $('#cardModal'+id).modal('show');
      }

      // 댓글 버튼 
      //$().button('disponse')
      function openCmt(id){
        if ( $('#writeModalUser').text().length == 0 ){
          alert('로그인이 필요합니다.')
        }else {
        $('#cancel'+ id).show();
        $('#cmtAdd' + id).show();
        $('#cmt' + id).hide();
        $('#commentArea1' + id).show();
        }
      }

      function closeCmt(id){
        $('#cancel'+ id).hide();
        $('#cmtAdd' + id).hide();
        $('#cmt' + id).show();
        $('#commentArea1' + id).hide();
        $('#commentArea2' + id).val('');
      }

      function addCmt(id){
        var txt = $('#commentArea2' + id).val()

        send_ajax('/boo/comment', 'POST', {'list_id' : id, 'cmt_txt' : txt}, '', 
        function(data) { getComment(data) } )
        ;
        
        $('#cancel'+ id).hide();
        $('#cmtAdd' + id).hide();
        $('#cmt' + id).show();
        $('#commentArea1' + id).hide();
        $('#commentArea2' + id).val('');
      }

      function openModals(id) {
        send_ajax("/boo/card/" + id, 'GET', '', '', function(res) {
            console.log("modals>>", res)
            hbs( 'card_modal_'+ id, res, 'cm' + id);  

            getComment(id);
        }); 
      }
      
       function getComment(id) {
        send_ajax('/boo/comment/' + id, 'GET', '', '', function(res) {
            if (!res || !res.length) return;
            console.log("comments>>", res)
            hbs('comment_template_' + id, {cmts: res}, 'comments' + id);
        });
      }

      function hbs(sourceId, data, resultId) {
          var source = document.getElementById(sourceId).innerHTML;
          var template = Handlebars.compile(source);
          var html = template(data);
          var result = document.getElementById(resultId).innerHTML;
  
          if ( result ) {
            //$('#' + resultId).append(data[data.length])
            console.log('comment resultId', resultId)
            console.log('last data', Object.values(data),)
          
          } else {
            document.getElementById(resultId).innerHTML = html;
          }
      }


      

      function render(template, data, resultId) {
        document.getElementById(resultId).innerHTML = template(data);
        }

  </script>

</body>

</html>
